{% load static %}

<div class="row">
    <div class="col-12">
        <h2 class="text-center mb-4">Inactive Members</h2>
    </div>
</div>

<!-- Section Navigation -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5>Select Section</h5>
            </div>
            <div class="card-body">
                <div class="btn-group flex-wrap" role="group">
                    {% for sect in sections %}
                        <a href="{% url 'attendance-capture' sect.name|lower|slugify %}" 
                           hx-get="{% url 'attendance-capture' sect.name|lower|slugify %}"
                           hx-target="#attendance-container"
                           hx-indicator="#section-loading-{{ sect.id }}"
                           class="btn btn-outline-primary mb-2">
                            <span id="section-loading-{{ sect.id }}" class="htmx-indicator spinner-border spinner-border-sm me-2" style="display: none;"></span>
                            {{ sect.name }}
                        </a>
                    {% endfor %}
                    <a href="{% url 'attendance-capture' 'no-section' %}" 
                       hx-get="{% url 'attendance-capture' 'no-section' %}"
                       hx-target="#attendance-container"
                       hx-indicator="#section-loading-no-section"
                       class="btn btn-outline-secondary mb-2">
                        <span id="section-loading-no-section" class="htmx-indicator spinner-border spinner-border-sm me-2" style="display: none;"></span>
                        <i class="fa fa-question-circle"></i> No Section
                    </a>
                    <a href="{% url 'inactive-members' %}" 
                       hx-get="{% url 'inactive-members' %}"
                       hx-target="#attendance-container"
                       hx-indicator="#section-loading-inactive"
                       class="btn btn-primary mb-2">
                        <span id="section-loading-inactive" class="htmx-indicator spinner-border spinner-border-sm me-2" style="display: none;"></span>
                        <i class="fa fa-user-times"></i> Inactive Members
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success/Error Messages -->
{% if message %}
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fa fa-check-circle"></i> {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
    </div>
{% endif %}

{% if error %}
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fa fa-exclamation-triangle"></i> {{ error }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
    </div>
{% endif %}

<!-- Inactive Members List -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fa fa-user-times"></i> Inactive Members Management</h5>
                <p class="text-muted mb-0">Members who are currently marked as inactive. Click "Reactivate" to make them active again.</p>
            </div>
            <div class="card-body">
                {% if inactive_members %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Instruments</th>
                                    <th>Last Seen</th>
                                    <th>Join Date</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for member in inactive_members %}
                                    <tr id="member-row-{{ member.id }}">
                                        <td>
                                            <strong>{{ member.first_name }} {{ member.last_name }}</strong>
                                            {% if member.preferred_name %}
                                                <br><small class="text-muted">"{{ member.preferred_name }}"</small>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if member.email %}
                                                <a href="mailto:{{ member.email }}">{{ member.email }}</a>
                                            {% else %}
                                                <span class="text-muted">—</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if member.phone %}
                                                <a href="tel:{{ member.phone }}">{{ member.phone }}</a>
                                            {% else %}
                                                <span class="text-muted">—</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if member.instruments.exists %}
                                                {% for instrument in member.instruments.all %}
                                                    <span class="badge bg-info text-white me-1">{{ instrument.instrument.name }}</span>
                                                {% endfor %}
                                            {% else %}
                                                <span class="text-muted">No instruments</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if member.last_seen %}
                                                {{ member.last_seen|date:"M j, Y" }}
                                            {% else %}
                                                <span class="text-muted">Never</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if member.join_date %}
                                                {{ member.join_date|date:"M j, Y" }}
                                            {% else %}
                                                <span class="text-muted">Unknown</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <form method="post" 
                                                  hx-post="{% url 'inactive-members' %}"
                                                  hx-target="#attendance-container"
                                                  hx-swap="innerHTML"
                                                  class="d-inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="member_id" value="{{ member.id }}">
                                                <button type="submit" 
                                                        class="btn btn-success btn-sm"
                                                        onclick="return confirm('Are you sure you want to reactivate {{ member.first_name }} {{ member.last_name }}?')">
                                                    <span class="htmx-indicator spinner-border spinner-border-sm me-1" style="display: none;"></span>
                                                    <i class="fa fa-user-check"></i> Reactivate
                                                </button>
                                            </form>
                                            <a href="{% url 'wagtailsnippets_blowcomotion_member:edit' member.id %}" 
                                               target="_blank" 
                                               class="btn btn-outline-secondary btn-sm ms-1">
                                                <i class="fa fa-edit"></i> Edit
                                            </a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-3">
                        <p class="text-muted">
                            <i class="fa fa-info-circle"></i> 
                            Total inactive members: <strong>{{ inactive_members.count }}</strong>
                        </p>
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <div class="mb-3">
                            <i class="fa fa-users text-success" style="font-size: 3rem;"></i>
                        </div>
                        <h4 class="text-success">All Members Active!</h4>
                        <p class="text-muted">There are currently no inactive members in the system.</p>
                        <div class="mt-4">
                            <a href="{% url 'attendance-capture' 'no-section' %}" 
                               hx-get="{% url 'attendance-capture' 'no-section' %}"
                               hx-target="#attendance-container"
                               class="btn btn-primary">
                                <i class="fa fa-check"></i> Record Attendance
                            </a>
                            <a href="{% url 'attendance-reports' %}" 
                               hx-get="{% url 'attendance-reports' %}"
                               hx-target="#attendance-container"
                               class="btn btn-outline-secondary ms-2">
                                <i class="fa fa-bar-chart"></i> View Reports
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
/* HTMX loading states */
.htmx-request .htmx-indicator {
    display: inline-block !important;
}

.htmx-request button[type="submit"] {
    opacity: 0.6;
    pointer-events: none;
}

/* Table improvements */
.table td {
    vertical-align: middle;
}

.badge {
    font-size: 0.8em;
}

/* Button improvements */
.btn-sm {
    font-size: 0.85rem;
}

/* Alert improvements */
.alert {
    margin-bottom: 0;
}

/* Loading spinner positioning */
.htmx-indicator.spinner-border-sm {
    width: 1rem;
    height: 1rem;
}
</style>
